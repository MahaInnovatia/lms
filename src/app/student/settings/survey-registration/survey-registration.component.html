<section class="content">
  <div class="content-block">
    <div class="block-header" *ngFor="let breadscrum of breadscrums">
    
      <app-breadcrumb
        [title]="breadscrum.title"
        [items]="breadscrum.items"
        [active_item]="breadscrum.active"
      >
      </app-breadcrumb>
    </div>
    <div class="row clearfix">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <div class="card" style="height: fit-content">
          <div class="body">
            <mat-tab-group [(selectedIndex)]="selectedTabIndex" (selectedTabChange)="onTabChange($event)" class="mt-4">
              <mat-tab label="Site Registration">
                <div class="mt-4"></div>
              </mat-tab>

              <mat-tab label="3rd Party Website Integration">
                <div class="mt-4"></div>
              </mat-tab>
            </mat-tab-group>

            <div class="form-card">
              <form (ngSubmit)="$event.preventDefault(); addField()" #fieldForm="ngForm">
                <div class="row">
                  <div class="col-12">
                    <mat-form-field appearance="outline" class="w-100">
                      <mat-label>Company</mat-label>
                      <input matInput [value]="companyName" readonly />
                    </mat-form-field>
                   
                  </div>
                  <div class="row">
                    <div class="col-3">
                      <mat-form-field appearance="outline">
                        <mat-label>Label</mat-label>
                        <!-- <span *ngIf="field.required" class="text-danger">*</span> -->
                        <input
                          matInput
                          type="text"
                          [(ngModel)]="newField.label"
                          (ngModelChange)="onLabelChange()"
                          name="label"
                          required
                        />
                      </mat-form-field>
                    </div>
                    <div class="col-3">
                      <mat-form-field appearance="outline">
                        <mat-label>Field Type</mat-label>
                        <mat-select
                          [(ngModel)]="newField.type"
                          name="type"
                          (selectionChange)="onFieldTypeChange()"
                        >
                          <mat-option
                            *ngFor="let t of fieldTypes"
                            [value]="t"
                            [disabled]="(newField.label.toLowerCase() === 'gender' || newField.label.toLowerCase() === 'sex') && t !== 'Dropdown'"
                            >{{ t }}</mat-option
                          >
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-3">
                      <mat-form-field appearance="outline">
                        <mat-label>Attributes</mat-label>
                        <mat-select
                          [(ngModel)]="newField.attr"
                          name="attr"
                        >
                          <mat-option
                            *ngFor="let t of attr"
                            [value]="t"
                            >{{ t }}</mat-option
                          >
                        </mat-select>
                      </mat-form-field>
                    </div>

                    <div class="col-3 mt-3">
                      <mat-slide-toggle
                        [(ngModel)]="newField.required"
                        name="required"
                        >Required</mat-slide-toggle
                      >
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-8" *ngIf="newField.type === 'Password'">
                      <div>
                        <mat-radio-group
                          [(ngModel)]="newField.strength"
                          name="strength"
                          required
                        >
                          <mat-radio-button value="normal"
                            >Normal</mat-radio-button
                          >
                          <mat-radio-button value="strong"
                            >Strong</mat-radio-button
                          >
                        </mat-radio-group>
                        <div class="d-flex gap-3" *ngIf="newField.type === 'Password'">
                          <mat-form-field appearance="outline">
                            <mat-label>Min length</mat-label>
                            <input
                              matInput
                              type="number"
                              [(ngModel)]="newField.minLength"
                              name="minLength"
                              required
                              [min]="1"
                            />
                          </mat-form-field>
                          <mat-form-field appearance="outline">
                            <mat-label>Max length</mat-label>
                            <input
                              matInput
                              type="number"
                              [(ngModel)]="newField.maxLength"
                              name="maxLength"
                              required
                              [min]="newField.minLength || 1"
                            />
                          </mat-form-field>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div *ngIf="showOptions()">
                  <label>Options:</label>

                  <div *ngIf="newField.options">
                    <div
                      *ngFor="let opt of newField.options; let i = index"
                      class="d-flex align-items-center mb-2"
                    >
                      <mat-form-field appearance="outline" class="flex-grow-1">
                        <input
                          matInput
                          [(ngModel)]="newField.options[i]"
                          [name]="'option' + i"
                          (keydown.enter)="$event.preventDefault()"
                        />
                      </mat-form-field>
                      <button
                        mat-icon-button
                        color="warn"
                        type="button"
                        (click)="removeNewOption(i)"
                      >
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>

                  <button
                    mat-button
                    color="primary"
                    type="button"
                    (click)="addOption()"
                  >
                    + Add Option
                  </button>
                </div>

                <div class="button-wrapper">
                  <button mat-raised-button color="primary" type="submit">
                    {{ editIndex !== null ? 'Update Field' : 'Add Field' }}
                  </button>
                  <div class="note-text mt-2" style="font-size: 12px; color: #666;">
                    <mat-icon style="font-size: 16px; height: 16px; width: 16px; vertical-align: text-bottom;">info</mat-icon>
                    <span>Note: Department, Country, City labels names cannot be created. Administrator can assign these information from Trainee module.</span>
                  </div>
                  <div *ngIf="getRestrictedFieldMessage()" class="restricted-field-warning mt-2">
                    <mat-icon class="warning-icon">info</mat-icon>
                    <span [innerHTML]="getRestrictedFieldMessage()"></span>
                  </div>
                  <div *ngIf="getAttributeValidationMessage()" class="restricted-field-warning mt-2">
                    <mat-icon class="warning-icon">info</mat-icon>
                    <span [innerHTML]="getAttributeValidationMessage()"></span>
                  </div>
                </div>
              </form>

              <hr />

              <label class="form-preview-label">Preview:</label>
              <ul>
                <div
                  *ngFor="let field of fields; let i = index"
                  class="preview-field mb-3"
                >
                  <div class="form-group row align-items-center">
                    <label class="col-sm-3 col-form-label"
                      >{{ field.label
                      }}<span *ngIf="field.required" class="text-danger"
                        >*</span
                      >
                    </label>
                    <div class="col-sm-7">
                      <ng-container [ngSwitch]="field.type.trim().toLowerCase()">
                        <input
                          *ngSwitchCase="'text'"
                          type="text"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        />
                        <input
                          *ngSwitchCase="'password'"
                          type="password"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        />
                        <textarea
                          *ngSwitchCase="'textarea'"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        ></textarea>
                        <input
                          *ngSwitchCase="'number'"
                          type="number"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        />
                        <input
                          *ngSwitchCase="'email'"
                          type="email"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        />
                        <input
                          *ngSwitchCase="'date'"
                          type="date"
                          class="form-control"
                          [(ngModel)]="field.value"
                          [name]="'field_' + i"
                        />
                        <input
                          *ngSwitchCase="'upload'"
                          type="file"
                          class="form-control"
                          (change)="onFileSelected($event, field)"
                          [name]="'field_' + i"
                        />

                        <select *ngSwitchCase="'dropdown'" class="form-control" [(ngModel)]="field.value" [name]="'field_' + i">
                          <option value="">Select an option</option>
                          <option *ngFor="let opt of field.options" [value]="opt">
                            {{ opt }}
                          </option>
                        </select>

                        <div *ngSwitchCase="'checkbox'" class="form-check">
                          <div *ngFor="let opt of field.options">
                            <mat-checkbox
                              [(ngModel)]="field.value"
                              [value]="opt"
                              [name]="opt"
                            >
                              {{ opt }}
                            </mat-checkbox>
                          </div>
                        </div>

                        <div *ngSwitchCase="'radio'">
                          <mat-radio-group
                            [(ngModel)]="field.value"
                            [name]="'field_' + i"
                          >
                            <mat-radio-button
                              *ngFor="let opt of field.options"
                              [value]="opt"
                              class="d-block mb-2"
                            >
                              {{ opt }}
                            </mat-radio-button>
                          </mat-radio-group>
                        </div>

                        <p *ngSwitchDefault class="text-muted">
                          Unsupported field type: {{ field.type }}
                        </p>
                      </ng-container>
                    </div>

                    <div class="col-sm-2 text-end">
                      <button
                        mat-icon-button
                        color="warn"
                        (click)="removeField(i)"
                      >
                        <mat-icon>delete</mat-icon>
                      </button>
                      <button
                        mat-icon-button
                        color="primary"
                        (click)="editField(i)"
                      >
                        <mat-icon>edit</mat-icon>
                      </button>
                    </div>
                  </div>
                </div>
              </ul>

              <div class="d-flex justify-content-end body sticky-save">
                <button
                  class="btn-space"
                  mat-raised-button
                  color="primary"
                  type="submit"
                  id="submit"
                  (click)="saveSurvey()"
                >
                  Save
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- <mat-card *ngIf="generatedCode || generatedApiEndpoint" class="mt-4">
  <mat-card-title>Integration Details</mat-card-title>
  <mat-card-content>
    <h4>  Generate Code</h4>
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>Copy the code below to your website</mat-label>
      <textarea matInput [value]="generatedCode" readonly rows="8">{{ generatedCode }}</textarea>
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="copyText(generatedCode)">Copy Generate Code</button>
    <h4 class="mt-4">API Endpoint</h4>
    <mat-form-field appearance="fill" class="w-100">
      <mat-label>API Endpoint</mat-label>
      <input matInput [value]="generatedApiEndpoint" readonly />
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="copyText(generatedApiEndpoint)">Copy API Endpoint</button>
  </mat-card-content>
</mat-card>  -->
